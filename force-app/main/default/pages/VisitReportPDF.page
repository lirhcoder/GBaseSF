<apex:page controller="VisitReportPDFController"
           renderAs="pdf"
           showHeader="false"
           sidebar="false"
           applyBodyTag="false"
           applyHtmlTag="false">
<html>
<head>
    <style type="text/css">
        @page {
            size: A4;
            margin: 20mm 15mm 20mm 15mm;

            @top-center {
                content: "訪問報告書 / Visit Report";
                font-size: 10pt;
                color: #666;
            }

            @bottom-center {
                content: "Page " counter(page) " of " counter(pages);
                font-size: 9pt;
                color: #666;
            }
        }

        body {
            font-family: Arial Unicode MS, sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #0176d3 0%, #014486 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .header h1 {
            margin: 0;
            font-size: 24pt;
            font-weight: bold;
        }

        .header h2 {
            margin: 5px 0 0 0;
            font-size: 12pt;
            font-weight: normal;
            opacity: 0.9;
        }

        .section {
            margin-bottom: 20px;
            page-break-inside: avoid;
        }

        .section-title {
            background-color: #f3f3f3;
            padding: 8px 12px;
            font-size: 12pt;
            font-weight: bold;
            color: #0176d3;
            border-left: 4px solid #0176d3;
            margin-bottom: 10px;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .info-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e5e5e5;
        }

        .info-table .label {
            width: 30%;
            font-weight: bold;
            color: #555;
            background-color: #fafafa;
        }

        .info-table .value {
            width: 70%;
        }

        .highlight-box {
            background-color: #e5f5fc;
            border: 1px solid #0176d3;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .highlight-box .amount {
            font-size: 18pt;
            font-weight: bold;
            color: #0176d3;
        }

        ul {
            margin: 0;
            padding-left: 20px;
        }

        ul li {
            margin-bottom: 8px;
        }

        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #e5e5e5;
            font-size: 9pt;
            color: #888;
            text-align: center;
        }

        .meta-info {
            font-size: 9pt;
            color: #888;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>訪問報告書</h1>
        <h2>Visit Report</h2>
    </div>

    <!-- Report Info -->
    <apex:outputPanel rendered="{!report != null}">
        <!-- Basic Information Section -->
        <div class="section">
            <div class="section-title">基本情報 / Basic Information</div>
            <table class="info-table">
                <tr>
                    <td class="label">報告書番号</td>
                    <td class="value">{!report.Name}</td>
                </tr>
                <tr>
                    <td class="label">訪問日</td>
                    <td class="value">{!formattedDate}</td>
                </tr>
                <tr>
                    <td class="label">会社名</td>
                    <td class="value">{!report.Company_Name__c}</td>
                </tr>
                <tr>
                    <td class="label">担当者</td>
                    <td class="value">
                        {!report.Contact_Name__c}
                        <apex:outputText rendered="{!NOT(ISBLANK(report.Contact_Title__c))}">
                            ({!report.Contact_Title__c})
                        </apex:outputText>
                    </td>
                </tr>
                <tr>
                    <td class="label">訪問目的</td>
                    <td class="value">{!report.Visit_Purpose__c}</td>
                </tr>
            </table>
        </div>

        <!-- Discussion Summary Section -->
        <div class="section">
            <div class="section-title">商談内容 / Discussion Summary</div>
            <apex:outputPanel rendered="{!discussionPoints.size > 0}">
                <ul>
                    <apex:repeat value="{!discussionPoints}" var="point">
                        <li>{!point}</li>
                    </apex:repeat>
                </ul>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!discussionPoints.size == 0}">
                <p style="color: #888;">記録なし</p>
            </apex:outputPanel>
        </div>

        <!-- Opportunity Section -->
        <apex:outputPanel rendered="{!report.Opportunity_Amount__c != null}">
            <div class="section">
                <div class="section-title">商談情報 / Opportunity Information</div>
                <div class="highlight-box">
                    <table style="width: 100%;">
                        <tr>
                            <td style="width: 50%;">
                                <div style="font-size: 10pt; color: #555;">商談金額</div>
                                <div class="amount">{!formattedAmount}</div>
                            </td>
                            <apex:outputPanel layout="none" rendered="{!report.Expected_Close_Date__c != null}">
                                <td style="width: 50%;">
                                    <div style="font-size: 10pt; color: #555;">予想成約日</div>
                                    <div style="font-size: 14pt; font-weight: bold;">
                                        <apex:outputText value="{0, date, yyyy年MM月dd日}">
                                            <apex:param value="{!report.Expected_Close_Date__c}"/>
                                        </apex:outputText>
                                    </div>
                                </td>
                            </apex:outputPanel>
                        </tr>
                    </table>
                </div>
            </div>
        </apex:outputPanel>

        <!-- Next Actions Section -->
        <div class="section">
            <div class="section-title">次のアクション / Next Actions</div>
            <apex:outputPanel rendered="{!actionItems.size > 0}">
                <ul>
                    <apex:repeat value="{!actionItems}" var="action">
                        <li>{!action}</li>
                    </apex:repeat>
                </ul>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!actionItems.size == 0}">
                <p style="color: #888;">記録なし</p>
            </apex:outputPanel>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>このレポートはSalesforce AI営業報告システムにより自動生成されました。</p>
            <p class="meta-info">
                作成日時:
                <apex:outputText value="{0, date, yyyy年MM月dd日 HH:mm}">
                    <apex:param value="{!report.CreatedDate}"/>
                </apex:outputText>
                &nbsp;|&nbsp;
                作成者: {!report.CreatedBy.Name}
            </p>
        </div>
    </apex:outputPanel>

    <!-- Error State -->
    <apex:outputPanel rendered="{!report == null}">
        <div style="text-align: center; padding: 50px; color: #888;">
            <p>レポートが見つかりません。</p>
            <p>Report not found.</p>
        </div>
    </apex:outputPanel>
</body>
</html>
</apex:page>
