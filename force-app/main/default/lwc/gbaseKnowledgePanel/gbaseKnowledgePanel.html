<template>
    <lightning-card title="GBase AI Assistant" icon-name="custom:custom14">
        <!-- Header with language selector -->
        <div slot="actions">
            <lightning-combobox
                name="language"
                label=""
                value={selectedLanguage}
                placeholder="Language"
                options={languageOptions}
                onchange={handleLanguageChange}
                variant="label-hidden"
                class="language-selector">
            </lightning-combobox>
        </div>

        <div class="slds-p-horizontal_medium slds-p-bottom_medium">
            <!-- Search Input Area -->
            <div class="search-container slds-m-bottom_medium">
                <lightning-input
                    type="text"
                    label={inputLabel}
                    placeholder={inputPlaceholder}
                    value={userQuestion}
                    onchange={handleQuestionChange}
                    onkeyup={handleKeyUp}
                    class="search-input">
                </lightning-input>
                <div class="button-group slds-m-top_small">
                    <lightning-button
                        label={askButtonLabel}
                        variant="brand"
                        onclick={handleAsk}
                        disabled={isAskDisabled}
                        class="slds-m-right_x-small">
                    </lightning-button>
                    <lightning-button
                        label={clearButtonLabel}
                        variant="neutral"
                        onclick={handleClear}
                        disabled={isClearDisabled}>
                    </lightning-button>
                </div>
            </div>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="slds-is-relative loading-container">
                    <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                    <p class="slds-text-align_center slds-m-top_medium loading-text">{loadingText}</p>
                </div>
            </template>

            <!-- Error Message -->
            <template if:true={hasError}>
                <div class="slds-notify slds-notify_alert slds-alert_error slds-m-bottom_medium" role="alert">
                    <lightning-icon icon-name="utility:error" alternative-text="Error" size="small" class="slds-m-right_x-small"></lightning-icon>
                    <span>{errorMessage}</span>
                </div>
            </template>

            <!-- Answer Display -->
            <template if:true={hasAnswer}>
                <div class="answer-container slds-box slds-theme_shade slds-m-bottom_medium">
                    <div class="slds-text-heading_small slds-m-bottom_small">
                        <lightning-icon icon-name="utility:knowledge_base" size="small" class="slds-m-right_x-small"></lightning-icon>
                        {answerLabel}
                    </div>
                    <!-- Rich Content Renderer -->
                    <div class="answer-text slds-text-body_regular">
                        <lightning-formatted-rich-text value={answer}></lightning-formatted-rich-text>
                    </div>

                    <!-- Sources -->
                    <template if:true={hasSources}>
                        <div class="sources-container slds-m-top_medium slds-p-top_small slds-border_top">
                            <span class="slds-text-title_caps slds-text-color_weak">{sourcesLabel}</span>
                            <ul class="slds-list_dotted slds-m-top_x-small">
                                <template for:each={sources} for:item="source">
                                    <li key={source.id} class="source-item">
                                        <lightning-icon icon-name="utility:file" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        {source.title}
                                        <span class="relevance-badge slds-badge slds-m-left_x-small">{source.relevancePercent}</span>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </template>

                    <!-- Copy to Clipboard -->
                    <div class="slds-m-top_small">
                        <lightning-button-icon
                            icon-name="utility:copy_to_clipboard"
                            alternative-text="Copy answer"
                            title="Copy to clipboard"
                            onclick={handleCopyAnswer}
                            size="small">
                        </lightning-button-icon>
                    </div>
                </div>
            </template>

            <!-- Suggested Questions -->
            <template if:true={hasSuggestedQuestions}>
                <div class="suggested-questions slds-m-top_medium">
                    <span class="slds-text-title_caps slds-text-color_weak">{suggestedLabel}</span>
                    <div class="slds-m-top_x-small">
                        <template for:each={suggestedQuestions} for:item="question">
                            <lightning-badge
                                key={question}
                                label={question}
                                onclick={handleSuggestedClick}
                                data-question={question}
                                class="suggested-badge slds-m-right_x-small slds-m-bottom_x-small">
                            </lightning-badge>
                        </template>
                    </div>
                </div>
            </template>

            <!-- Related Knowledge -->
            <template if:true={hasRelatedKnowledge}>
                <div class="related-knowledge slds-m-top_medium">
                    <span class="slds-text-title_caps slds-text-color_weak">{relatedLabel}</span>
                    <ul class="slds-m-top_x-small">
                        <template for:each={relatedKnowledge} for:item="item">
                            <li key={item.id} class="related-item slds-p-vertical_xx-small">
                                <a href="javascript:void(0)" onclick={handleRelatedClick} data-title={item.title}>
                                    {item.title}
                                </a>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>
        </div>

        <!-- Footer -->
        <div slot="footer" class="slds-text-align_center">
            <span class="slds-text-body_small slds-text-color_weak">
                Powered by GBase Support AI
            </span>
        </div>
    </lightning-card>
</template>